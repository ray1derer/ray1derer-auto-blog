<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì œ17ê°•: ë°±ì—”ë“œ í”„ë ˆì„ì›Œí¬ì™€ Cursor AI | Cursor AI ë§ˆìŠ¤í„° í´ë˜ìŠ¤</title>
    <link rel="stylesheet" href="../assets/lesson-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="lesson-container">
        <header class="lesson-header">
            <div class="lesson-title">
                <h1><i class="fas fa-server"></i> ì œ17ê°•: ë°±ì—”ë“œ í”„ë ˆì„ì›Œí¬ì™€ Cursor AI</h1>
                <p class="lesson-subtitle">Node.js, Python, Javaë¡œ êµ¬ì¶•í•˜ëŠ” AI ì§€ì› ì„œë²„ ê°œë°œ</p>
            </div>
            <div class="lesson-meta">
                <span class="difficulty"><i class="fas fa-signal"></i> ë‚œì´ë„: ì¤‘ê¸‰</span>
                <span class="duration"><i class="fas fa-clock"></i> ì˜ˆìƒ ì‹œê°„: 55ë¶„</span>
                <span class="category"><i class="fas fa-folder"></i> ì¹´í…Œê³ ë¦¬: ì¤‘ê¸‰</span>
            </div>
        </header>

        <nav class="lesson-nav">
            <a href="lesson16.html" class="nav-link prev">
                <i class="fas fa-chevron-left"></i> ì´ì „ ê°•ì˜
            </a>
            <span class="nav-title">ì œ17ê°•: ë°±ì—”ë“œ í”„ë ˆì„ì›Œí¬ì™€ Cursor AI</span>
            <a href="lesson18.html" class="nav-link next">
                ë‹¤ìŒ ê°•ì˜ <i class="fas fa-chevron-right"></i>
            </a>
        </nav>

        <main class="lesson-content">
            <section class="learning-objectives">
                <h2><i class="fas fa-bullseye"></i> í•™ìŠµ ëª©í‘œ</h2>
                <ul>
                    <li>AIë¥¼ í™œìš©í•œ Express.js/NestJS ì„œë²„ êµ¬ì¶•í•˜ê¸°</li>
                    <li>FastAPI/Djangoë¡œ Python ë°±ì—”ë“œ ê°œë°œí•˜ê¸°</li>
                    <li>Spring Boot ì—”í„°í”„ë¼ì´ì¦ˆ ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¶•í•˜ê¸°</li>
                    <li>ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ ì„¤ê³„ì™€ êµ¬í˜„</li>
                    <li>ì‹¤ì‹œê°„ í†µì‹ ê³¼ ë©”ì‹œì§€ í ì‹œìŠ¤í…œ í†µí•©í•˜ê¸°</li>
                </ul>
            </section>

            <section class="content-section">
                <h2><i class="fas fa-node-js"></i> Node.js ë°±ì—”ë“œ ê°œë°œ</h2>
                
                <div class="info-box">
                    <p>Cursor AIëŠ” Express.jsì™€ NestJSì˜ êµ¬ì¡°ë¥¼ ì´í•´í•˜ê³ , í™•ì¥ ê°€ëŠ¥í•œ ë°±ì—”ë“œ ì„œë¹„ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤. ë¯¸ë“¤ì›¨ì–´, ë¼ìš°íŒ…, ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ê¹Œì§€ ëª¨ë“  ê³¼ì •ì„ ì§€ì›í•©ë‹ˆë‹¤.</p>
                </div>

                <h3>Express.js ì„œë²„ êµ¬ì¶•</h3>
                <div class="express-example">
                    <div class="server-request">
                        <h4>ìš”êµ¬ì‚¬í•­: JWT ì¸ì¦ì´ ìˆëŠ” RESTful API ì„œë²„</h4>
                        <p>AIì—ê²Œ ìš”ì²­: "JWT ì¸ì¦, íŒŒì¼ ì—…ë¡œë“œ, ì‹¤ì‹œê°„ ì•Œë¦¼ì´ ìˆëŠ” Express ì„œë²„ë¥¼ ë§Œë“¤ì–´ì¤˜"</p>
                    </div>

                    <div class="ai-generated-server">
                        <h4>AIê°€ ìƒì„±í•œ Express ì„œë²„</h4>
                        <pre><code>// server.ts
import express, { Application } from 'express';
import cors from 'cors';
import helmet from 'helmet';
import morgan from 'morgan';
import compression from 'compression';
import rateLimit from 'express-rate-limit';
import { createServer } from 'http';
import { Server } from 'socket.io';
import { config } from './config';
import { errorHandler } from './middleware/errorHandler';
import { authMiddleware } from './middleware/auth';
import routes from './routes';
import { connectDatabase } from './database';
import { initializeSocketHandlers } from './socket/handlers';
import { logger } from './utils/logger';

class App {
    private app: Application;
    private server: any;
    private io: Server;
    private port: number;

    constructor() {
        this.app = express();
        this.port = config.port || 3000;
        this.server = createServer(this.app);
        this.io = new Server(this.server, {
            cors: {
                origin: config.clientUrl,
                credentials: true
            }
        });

        this.initializeMiddlewares();
        this.initializeRoutes();
        this.initializeSocketIO();
        this.initializeErrorHandling();
    }

    private initializeMiddlewares(): void {
        // ë³´ì•ˆ í—¤ë”
        this.app.use(helmet({
            contentSecurityPolicy: {
                directives: {
                    defaultSrc: ["'self'"],
                    styleSrc: ["'self'", "'unsafe-inline'"],
                    scriptSrc: ["'self'"],
                    imgSrc: ["'self'", "data:", "https:"],
                },
            },
        }));

        // CORS ì„¤ì •
        this.app.use(cors({
            origin: config.allowedOrigins,
            credentials: true,
            optionsSuccessStatus: 200
        }));

        // ìš”ì²­ ë¡œê¹…
        this.app.use(morgan('combined', {
            stream: {
                write: (message: string) => logger.info(message.trim())
            }
        }));

        // Body íŒŒì‹±
        this.app.use(express.json({ limit: '10mb' }));
        this.app.use(express.urlencoded({ extended: true, limit: '10mb' }));

        // ì••ì¶•
        this.app.use(compression());

        // Rate limiting
        const limiter = rateLimit({
            windowMs: 15 * 60 * 1000, // 15ë¶„
            max: 100, // ìµœëŒ€ 100ê°œ ìš”ì²­
            message: 'Too many requests from this IP',
            standardHeaders: true,
            legacyHeaders: false,
        });

        this.app.use('/api/', limiter);

        // ì •ì  íŒŒì¼ ì œê³µ
        this.app.use('/uploads', express.static('uploads'));
    }

    private initializeRoutes(): void {
        // Health check
        this.app.get('/health', (req, res) => {
            res.json({
                status: 'ok',
                timestamp: new Date().toISOString(),
                uptime: process.uptime()
            });
        });

        // API ë¼ìš°íŠ¸
        this.app.use('/api', routes);

        // 404 ì²˜ë¦¬
        this.app.use('*', (req, res) => {
            res.status(404).json({
                success: false,
                message: 'Resource not found'
            });
        });
    }

    private initializeSocketIO(): void {
        // Socket.IO ì¸ì¦
        this.io.use(async (socket, next) => {
            try {
                const token = socket.handshake.auth.token;
                const user = await authMiddleware.verifyToken(token);
                socket.data.user = user;
                next();
            } catch (error) {
                next(new Error('Authentication failed'));
            }
        });

        // Socket í•¸ë“¤ëŸ¬ ì´ˆê¸°í™”
        initializeSocketHandlers(this.io);
    }

    private initializeErrorHandling(): void {
        this.app.use(errorHandler);

        // ì²˜ë¦¬ë˜ì§€ ì•Šì€ ì˜ˆì™¸ ì²˜ë¦¬
        process.on('uncaughtException', (error: Error) => {
            logger.error('Uncaught Exception:', error);
            process.exit(1);
        });

        process.on('unhandledRejection', (reason: any) => {
            logger.error('Unhandled Rejection:', reason);
            process.exit(1);
        });
    }

    public async start(): Promise<void> {
        try {
            // ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
            await connectDatabase();
            
            // ì„œë²„ ì‹œì‘
            this.server.listen(this.port, () => {
                logger.info(`ğŸš€ Server is running on port ${this.port}`);
                logger.info(`ğŸ“± Socket.IO is ready for connections`);
            });
        } catch (error) {
            logger.error('Failed to start server:', error);
            process.exit(1);
        }
    }

    public getApp(): Application {
        return this.app;
    }

    public getSocketIO(): Server {
        return this.io;
    }
}

export default new App();</code></pre>
                    </div>

                    <div class="auth-middleware">
                        <h4>JWT ì¸ì¦ ë¯¸ë“¤ì›¨ì–´</h4>
                        <pre><code>// middleware/auth.ts
import { Request, Response, NextFunction } from 'express';
import jwt from 'jsonwebtoken';
import { config } from '../config';
import { UserService } from '../services/user.service';
import { logger } from '../utils/logger';

interface JwtPayload {
    userId: string;
    email: string;
    role: string;
}

declare global {
    namespace Express {
        interface Request {
            user?: JwtPayload;
        }
    }
}

export class AuthMiddleware {
    private userService: UserService;

    constructor() {
        this.userService = new UserService();
    }

    async authenticate(req: Request, res: Response, next: NextFunction): Promise<void> {
        try {
            const token = this.extractToken(req);
            
            if (!token) {
                return res.status(401).json({
                    success: false,
                    message: 'No authentication token provided'
                });
            }

            const decoded = await this.verifyToken(token);
            
            // ì‚¬ìš©ì ì¡´ì¬ í™•ì¸
            const user = await this.userService.findById(decoded.userId);
            if (!user || !user.isActive) {
                return res.status(401).json({
                    success: false,
                    message: 'User not found or inactive'
                });
            }

            req.user = decoded;
            next();
        } catch (error) {
            logger.error('Authentication error:', error);
            
            if (error.name === 'TokenExpiredError') {
                return res.status(401).json({
                    success: false,
                    message: 'Token has expired',
                    code: 'TOKEN_EXPIRED'
                });
            }
            
            return res.status(401).json({
                success: false,
                message: 'Invalid authentication token'
            });
        }
    }

    authorize(...roles: string[]) {
        return (req: Request, res: Response, next: NextFunction) => {
            if (!req.user) {
                return res.status(401).json({
                    success: false,
                    message: 'Authentication required'
                });
            }

            if (roles.length && !roles.includes(req.user.role)) {
                return res.status(403).json({
                    success: false,
                    message: 'Insufficient permissions'
                });
            }

            next();
        };
    }

    private extractToken(req: Request): string | null {
        const authHeader = req.headers.authorization;
        
        if (authHeader && authHeader.startsWith('Bearer ')) {
            return authHeader.substring(7);
        }
        
        // ì¿ í‚¤ì—ì„œë„ í† í° í™•ì¸
        return req.cookies?.token || null;
    }

    async verifyToken(token: string): Promise<JwtPayload> {
        return new Promise((resolve, reject) => {
            jwt.verify(token, config.jwtSecret, (err, decoded) => {
                if (err) {
                    reject(err);
                } else {
                    resolve(decoded as JwtPayload);
                }
            });
        });
    }

    generateToken(payload: JwtPayload): string {
        return jwt.sign(payload, config.jwtSecret, {
            expiresIn: config.jwtExpiresIn || '7d'
        });
    }

    generateRefreshToken(userId: string): string {
        return jwt.sign({ userId }, config.jwtRefreshSecret, {
            expiresIn: '30d'
        });
    }
}

export const authMiddleware = new AuthMiddleware();</code></pre>
                    </div>

                    <div class="file-upload">
                        <h4>íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬</h4>
                        <pre><code>// routes/upload.routes.ts
import { Router } from 'express';
import multer from 'multer';
import path from 'path';
import { v4 as uuidv4 } from 'uuid';
import { authMiddleware } from '../middleware/auth';
import { uploadController } from '../controllers/upload.controller';

const router = Router();

// Multer ì„¤ì •
const storage = multer.diskStorage({
    destination: (req, file, cb) => {
        const uploadPath = path.join(__dirname, '../../uploads');
        cb(null, uploadPath);
    },
    filename: (req, file, cb) => {
        const uniqueName = `${uuidv4()}${path.extname(file.originalname)}`;
        cb(null, uniqueName);
    }
});

const fileFilter = (req: any, file: Express.Multer.File, cb: multer.FileFilterCallback) => {
    const allowedMimes = [
        'image/jpeg',
        'image/png',
        'image/gif',
        'image/webp',
        'application/pdf',
        'application/msword',
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
    ];

    if (allowedMimes.includes(file.mimetype)) {
        cb(null, true);
    } else {
        cb(new Error('Invalid file type'));
    }
};

const upload = multer({
    storage,
    fileFilter,
    limits: {
        fileSize: 10 * 1024 * 1024 // 10MB
    }
});

// ë¼ìš°íŠ¸ ì •ì˜
router.post(
    '/single',
    authMiddleware.authenticate,
    upload.single('file'),
    uploadController.uploadSingle
);

router.post(
    '/multiple',
    authMiddleware.authenticate,
    upload.array('files', 5),
    uploadController.uploadMultiple
);

router.delete(
    '/:fileId',
    authMiddleware.authenticate,
    uploadController.deleteFile
);

export default router;</code></pre>
                    </div>
                </div>
            </section>

            <section class="content-section">
                <h2><i class="fas fa-python"></i> Python ë°±ì—”ë“œ ê°œë°œ</h2>

                <div class="python-examples">
                    <h3>FastAPI ê³ ì„±ëŠ¥ API ì„œë²„</h3>
                    
                    <div class="fastapi-server">
                        <h4>AIê°€ ìƒì„±í•œ FastAPI ì„œë²„</h4>
                        <pre><code># main.py
from fastapi import FastAPI, Depends, HTTPException, status
from fastapi.middleware.cors import CORSMiddleware
from fastapi.middleware.trustedhost import TrustedHostMiddleware
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials
from contextlib import asynccontextmanager
from typing import List, Optional
import uvicorn
from sqlalchemy.ext.asyncio import AsyncSession

from app.core.config import settings
from app.core.database import engine, get_db
from app.core.security import verify_token
from app.models import Base
from app.routers import auth, users, products, orders
from app.middleware.logging import LoggingMiddleware
from app.utils.redis_client import redis_client
from app.websocket.manager import connection_manager

# Lifespan ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
@asynccontextmanager
async def lifespan(app: FastAPI):
    # ì‹œì‘ ì‹œ
    async with engine.begin() as conn:
        await conn.run_sync(Base.metadata.create_all)
    
    await redis_client.connect()
    print("âœ… Database connected")
    print("âœ… Redis connected")
    
    yield
    
    # ì¢…ë£Œ ì‹œ
    await redis_client.close()
    await engine.dispose()
    print("ğŸ‘‹ Shutting down...")

# FastAPI ì•± ìƒì„±
app = FastAPI(
    title=settings.PROJECT_NAME,
    version=settings.VERSION,
    openapi_url=f"{settings.API_V1_STR}/openapi.json",
    lifespan=lifespan
)

# ë¯¸ë“¤ì›¨ì–´ ì„¤ì •
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.ALLOWED_ORIGINS,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

app.add_middleware(
    TrustedHostMiddleware,
    allowed_hosts=settings.ALLOWED_HOSTS
)

app.add_middleware(LoggingMiddleware)

# Security
security = HTTPBearer()

# í—¬ìŠ¤ ì²´í¬
@app.get("/health")
async def health_check():
    return {
        "status": "healthy",
        "service": settings.PROJECT_NAME,
        "version": settings.VERSION
    }

# ë³´í˜¸ëœ ì—”ë“œí¬ì¸íŠ¸ ì˜ˆì‹œ
@app.get("/api/v1/protected")
async def protected_route(
    credentials: HTTPAuthorizationCredentials = Depends(security),
    db: AsyncSession = Depends(get_db)
):
    token = credentials.credentials
    user = await verify_token(token, db)
    
    if not user:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Invalid authentication credentials"
        )
    
    return {"message": f"Hello {user.email}!"}

# ë¼ìš°í„° í¬í•¨
app.include_router(auth.router, prefix=f"{settings.API_V1_STR}/auth", tags=["auth"])
app.include_router(users.router, prefix=f"{settings.API_V1_STR}/users", tags=["users"])
app.include_router(products.router, prefix=f"{settings.API_V1_STR}/products", tags=["products"])
app.include_router(orders.router, prefix=f"{settings.API_V1_STR}/orders", tags=["orders"])

# WebSocket ì—”ë“œí¬ì¸íŠ¸
@app.websocket("/ws/{client_id}")
async def websocket_endpoint(websocket: WebSocket, client_id: str):
    await connection_manager.connect(websocket, client_id)
    try:
        while True:
            data = await websocket.receive_text()
            await connection_manager.broadcast(f"Client {client_id}: {data}")
    except WebSocketDisconnect:
        connection_manager.disconnect(client_id)
        await connection_manager.broadcast(f"Client {client_id} left the chat")

if __name__ == "__main__":
    uvicorn.run(
        "main:app",
        host="0.0.0.0",
        port=settings.PORT,
        reload=settings.DEBUG,
        log_config={
            "version": 1,
            "disable_existing_loggers": False,
            "formatters": {
                "default": {
                    "format": "%(asctime)s - %(name)s - %(levelname)s - %(message)s",
                },
            },
        }
    )</code></pre>
                    </div>

                    <div class="async-models">
                        <h4>ë¹„ë™ê¸° ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸</h4>
                        <pre><code># models/user.py
from sqlalchemy import Column, String, Boolean, DateTime
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.ext.hybrid import hybrid_property
from sqlalchemy.orm import relationship
import uuid
from datetime import datetime
from passlib.context import CryptContext

from app.models.base import Base

pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

class User(Base):
    __tablename__ = "users"

    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    email = Column(String, unique=True, index=True, nullable=False)
    username = Column(String, unique=True, index=True)
    hashed_password = Column(String, nullable=False)
    full_name = Column(String)
    is_active = Column(Boolean, default=True)
    is_superuser = Column(Boolean, default=False)
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    
    # ê´€ê³„
    orders = relationship("Order", back_populates="user", cascade="all, delete-orphan")
    addresses = relationship("Address", back_populates="user", cascade="all, delete-orphan")
    reviews = relationship("Review", back_populates="user", cascade="all, delete-orphan")
    
    def verify_password(self, plain_password: str) -> bool:
        return pwd_context.verify(plain_password, self.hashed_password)
    
    @classmethod
    def get_password_hash(cls, password: str) -> str:
        return pwd_context.hash(password)
    
    @hybrid_property
    def is_verified(self):
        # ì´ë©”ì¼ ì¸ì¦ ë¡œì§
        return self.email_verified_at is not None
    
    def to_dict(self, include_sensitive=False):
        data = {
            "id": str(self.id),
            "email": self.email,
            "username": self.username,
            "full_name": self.full_name,
            "is_active": self.is_active,
            "created_at": self.created_at.isoformat(),
            "updated_at": self.updated_at.isoformat()
        }
        
        if include_sensitive:
            data["is_superuser"] = self.is_superuser
            
        return data</code></pre>
                    </div>

                    <div class="async-crud">
                        <h4>ë¹„ë™ê¸° CRUD ì‘ì—…</h4>
                        <pre><code># repositories/user_repository.py
from typing import Optional, List
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select, update, delete
from sqlalchemy.orm import selectinload
import uuid

from app.models.user import User
from app.schemas.user import UserCreate, UserUpdate
from app.core.security import get_password_hash

class UserRepository:
    def __init__(self, db: AsyncSession):
        self.db = db
    
    async def create(self, user_data: UserCreate) -> User:
        """ìƒˆ ì‚¬ìš©ì ìƒì„±"""
        user = User(
            email=user_data.email,
            username=user_data.username,
            hashed_password=get_password_hash(user_data.password),
            full_name=user_data.full_name
        )
        
        self.db.add(user)
        await self.db.commit()
        await self.db.refresh(user)
        
        return user
    
    async def get_by_id(self, user_id: uuid.UUID) -> Optional[User]:
        """IDë¡œ ì‚¬ìš©ì ì¡°íšŒ"""
        query = select(User).where(User.id == user_id)
        result = await self.db.execute(query)
        return result.scalar_one_or_none()
    
    async def get_by_email(self, email: str) -> Optional[User]:
        """ì´ë©”ì¼ë¡œ ì‚¬ìš©ì ì¡°íšŒ"""
        query = select(User).where(User.email == email)
        result = await self.db.execute(query)
        return result.scalar_one_or_none()
    
    async def get_all(
        self, 
        skip: int = 0, 
        limit: int = 100,
        include_inactive: bool = False
    ) -> List[User]:
        """ëª¨ë“  ì‚¬ìš©ì ì¡°íšŒ (í˜ì´ì§€ë„¤ì´ì…˜)"""
        query = select(User)
        
        if not include_inactive:
            query = query.where(User.is_active == True)
        
        query = query.offset(skip).limit(limit)
        result = await self.db.execute(query)
        
        return result.scalars().all()
    
    async def update(
        self, 
        user_id: uuid.UUID, 
        user_update: UserUpdate
    ) -> Optional[User]:
        """ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸"""
        update_data = user_update.dict(exclude_unset=True)
        
        if "password" in update_data:
            update_data["hashed_password"] = get_password_hash(update_data.pop("password"))
        
        query = (
            update(User)
            .where(User.id == user_id)
            .values(**update_data)
            .returning(User)
        )
        
        result = await self.db.execute(query)
        await self.db.commit()
        
        return result.scalar_one_or_none()
    
    async def delete(self, user_id: uuid.UUID) -> bool:
        """ì‚¬ìš©ì ì‚­ì œ"""
        query = delete(User).where(User.id == user_id)
        result = await self.db.execute(query)
        await self.db.commit()
        
        return result.rowcount > 0
    
    async def get_with_orders(self, user_id: uuid.UUID) -> Optional[User]:
        """ì£¼ë¬¸ ì •ë³´ì™€ í•¨ê»˜ ì‚¬ìš©ì ì¡°íšŒ"""
        query = (
            select(User)
            .options(selectinload(User.orders))
            .where(User.id == user_id)
        )
        
        result = await self.db.execute(query)
        return result.scalar_one_or_none()</code></pre>
                    </div>
                </div>
            </section>

            <section class="content-section">
                <h2><i class="fab fa-java"></i> Spring Boot ì—”í„°í”„ë¼ì´ì¦ˆ ê°œë°œ</h2>

                <div class="spring-examples">
                    <h3>Spring Boot ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤</h3>
                    
                    <div class="spring-service">
                        <h4>AIê°€ ìƒì„±í•œ Spring Boot ì„œë¹„ìŠ¤</h4>
                        <pre><code>// OrderService.java
package com.example.ecommerce.service;

import com.example.ecommerce.dto.OrderDTO;
import com.example.ecommerce.dto.OrderItemDTO;
import com.example.ecommerce.entity.Order;
import com.example.ecommerce.entity.OrderItem;
import com.example.ecommerce.entity.Product;
import com.example.ecommerce.entity.User;
import com.example.ecommerce.exception.InsufficientStockException;
import com.example.ecommerce.exception.ResourceNotFoundException;
import com.example.ecommerce.mapper.OrderMapper;
import com.example.ecommerce.repository.OrderRepository;
import com.example.ecommerce.repository.ProductRepository;
import com.example.ecommerce.repository.UserRepository;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.cache.annotation.CacheEvict;
import org.springframework.cache.annotation.Cacheable;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.kafka.core.KafkaTemplate;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.math.BigDecimal;
import java.time.LocalDateTime;
import java.util.List;
import java.util.UUID;
import java.util.stream.Collectors;

@Slf4j
@Service
@RequiredArgsConstructor
public class OrderService {
    
    private final OrderRepository orderRepository;
    private final UserRepository userRepository;
    private final ProductRepository productRepository;
    private final OrderMapper orderMapper;
    private final KafkaTemplate<String, Object> kafkaTemplate;
    private final InventoryService inventoryService;
    private final PaymentService paymentService;
    
    @Transactional
    public OrderDTO createOrder(OrderDTO orderDTO, String userId) {
        log.info("Creating order for user: {}", userId);
        
        // ì‚¬ìš©ì í™•ì¸
        User user = userRepository.findById(UUID.fromString(userId))
            .orElseThrow(() -> new ResourceNotFoundException("User not found"));
        
        // ì£¼ë¬¸ ìƒì„±
        Order order = new Order();
        order.setUser(user);
        order.setOrderNumber(generateOrderNumber());
        order.setStatus(Order.OrderStatus.PENDING);
        order.setCreatedAt(LocalDateTime.now());
        
        // ì£¼ë¬¸ í•­ëª© ì²˜ë¦¬
        BigDecimal totalAmount = BigDecimal.ZERO;
        
        for (OrderItemDTO itemDTO : orderDTO.getItems()) {
            Product product = productRepository.findById(itemDTO.getProductId())
                .orElseThrow(() -> new ResourceNotFoundException("Product not found"));
            
            // ì¬ê³  í™•ì¸
            if (!inventoryService.checkStock(product.getId(), itemDTO.getQuantity())) {
                throw new InsufficientStockException(
                    "Insufficient stock for product: " + product.getName()
                );
            }
            
            OrderItem orderItem = new OrderItem();
            orderItem.setOrder(order);
            orderItem.setProduct(product);
            orderItem.setQuantity(itemDTO.getQuantity());
            orderItem.setPrice(product.getPrice());
            orderItem.setSubtotal(
                product.getPrice().multiply(BigDecimal.valueOf(itemDTO.getQuantity()))
            );
            
            order.getItems().add(orderItem);
            totalAmount = totalAmount.add(orderItem.getSubtotal());
        }
        
        order.setTotalAmount(totalAmount);
        
        // ì¬ê³  ì°¨ê°
        for (OrderItem item : order.getItems()) {
            inventoryService.decreaseStock(
                item.getProduct().getId(), 
                item.getQuantity()
            );
        }
        
        // ì£¼ë¬¸ ì €ì¥
        Order savedOrder = orderRepository.save(order);
        
        // ê²°ì œ ì²˜ë¦¬
        try {
            PaymentResult paymentResult = paymentService.processPayment(
                savedOrder.getId(),
                totalAmount,
                orderDTO.getPaymentMethod()
            );
            
            if (paymentResult.isSuccess()) {
                savedOrder.setStatus(Order.OrderStatus.PAID);
                savedOrder.setPaymentId(paymentResult.getTransactionId());
            } else {
                // ì¬ê³  ë³µì›
                rollbackInventory(savedOrder);
                savedOrder.setStatus(Order.OrderStatus.PAYMENT_FAILED);
            }
        } catch (Exception e) {
            log.error("Payment processing failed", e);
            rollbackInventory(savedOrder);
            savedOrder.setStatus(Order.OrderStatus.PAYMENT_FAILED);
        }
        
        savedOrder = orderRepository.save(savedOrder);
        
        // ì´ë²¤íŠ¸ ë°œí–‰
        publishOrderEvent(savedOrder);
        
        return orderMapper.toDTO(savedOrder);
    }
    
    @Transactional(readOnly = true)
    @Cacheable(value = "orders", key = "#orderId")
    public OrderDTO getOrder(String orderId) {
        Order order = orderRepository.findById(UUID.fromString(orderId))
            .orElseThrow(() -> new ResourceNotFoundException("Order not found"));
        
        return orderMapper.toDTO(order);
    }
    
    @Transactional(readOnly = true)
    public Page<OrderDTO> getUserOrders(String userId, Pageable pageable) {
        Page<Order> orders = orderRepository.findByUserIdOrderByCreatedAtDesc(
            UUID.fromString(userId), 
            pageable
        );
        
        return orders.map(orderMapper::toDTO);
    }
    
    @Transactional
    @CacheEvict(value = "orders", key = "#orderId")
    public OrderDTO updateOrderStatus(String orderId, Order.OrderStatus status) {
        Order order = orderRepository.findById(UUID.fromString(orderId))
            .orElseThrow(() -> new ResourceNotFoundException("Order not found"));
        
        Order.OrderStatus previousStatus = order.getStatus();
        order.setStatus(status);
        order.setUpdatedAt(LocalDateTime.now());
        
        // ìƒíƒœ ë³€ê²½ì— ë”°ë¥¸ ì²˜ë¦¬
        switch (status) {
            case SHIPPED:
                order.setShippedAt(LocalDateTime.now());
                sendShipmentNotification(order);
                break;
            case DELIVERED:
                order.setDeliveredAt(LocalDateTime.now());
                sendDeliveryNotification(order);
                break;
            case CANCELLED:
                handleOrderCancellation(order);
                break;
        }
        
        Order updatedOrder = orderRepository.save(order);
        
        // ìƒíƒœ ë³€ê²½ ì´ë²¤íŠ¸ ë°œí–‰
        publishStatusChangeEvent(updatedOrder, previousStatus);
        
        return orderMapper.toDTO(updatedOrder);
    }
    
    @Transactional
    public void cancelOrder(String orderId, String reason) {
        Order order = orderRepository.findById(UUID.fromString(orderId))
            .orElseThrow(() -> new ResourceNotFoundException("Order not found"));
        
        // ì·¨ì†Œ ê°€ëŠ¥ ìƒíƒœ í™•ì¸
        if (!order.isCancellable()) {
            throw new IllegalStateException(
                "Order cannot be cancelled in current status: " + order.getStatus()
            );
        }
        
        // ì¬ê³  ë³µì›
        rollbackInventory(order);
        
        // í™˜ë¶ˆ ì²˜ë¦¬
        if (order.getPaymentId() != null) {
            paymentService.refund(order.getPaymentId(), order.getTotalAmount());
        }
        
        order.setStatus(Order.OrderStatus.CANCELLED);
        order.setCancellationReason(reason);
        order.setCancelledAt(LocalDateTime.now());
        
        orderRepository.save(order);
        
        // ì·¨ì†Œ ì•Œë¦¼
        sendCancellationNotification(order);
    }
    
    private String generateOrderNumber() {
        return "ORD-" + System.currentTimeMillis() + "-" + 
               UUID.randomUUID().toString().substring(0, 8).toUpperCase();
    }
    
    private void rollbackInventory(Order order) {
        for (OrderItem item : order.getItems()) {
            inventoryService.increaseStock(
                item.getProduct().getId(), 
                item.getQuantity()
            );
        }
    }
    
    private void publishOrderEvent(Order order) {
        OrderEvent event = new OrderEvent(
            order.getId(),
            order.getOrderNumber(),
            order.getStatus(),
            order.getTotalAmount(),
            order.getUser().getEmail()
        );
        
        kafkaTemplate.send("order-events", event);
    }
    
    private void publishStatusChangeEvent(Order order, Order.OrderStatus previousStatus) {
        StatusChangeEvent event = new StatusChangeEvent(
            order.getId(),
            previousStatus,
            order.getStatus(),
            LocalDateTime.now()
        );
        
        kafkaTemplate.send("order-status-events", event);
    }
    
    private void sendShipmentNotification(Order order) {
        // ë°°ì†¡ ì•Œë¦¼ ë¡œì§
    }
    
    private void sendDeliveryNotification(Order order) {
        // ë°°ë‹¬ ì™„ë£Œ ì•Œë¦¼ ë¡œì§
    }
    
    private void sendCancellationNotification(Order order) {
        // ì·¨ì†Œ ì•Œë¦¼ ë¡œì§
    }
}</code></pre>
                    </div>

                    <div class="spring-config">
                        <h4>Spring Security ì„¤ì •</h4>
                        <pre><code>// SecurityConfig.java
package com.example.ecommerce.config;

import com.example.ecommerce.security.JwtAuthenticationFilter;
import com.example.ecommerce.security.JwtAuthenticationEntryPoint;
import lombok.RequiredArgsConstructor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;
import org.springframework.security.config.annotation.method.configuration.EnableMethodSecurity;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.CorsConfigurationSource;
import org.springframework.web.cors.UrlBasedCorsConfigurationSource;

import java.util.Arrays;

@Configuration
@EnableWebSecurity
@EnableMethodSecurity(prePostEnabled = true)
@RequiredArgsConstructor
public class SecurityConfig {
    
    private final JwtAuthenticationEntryPoint jwtAuthenticationEntryPoint;
    private final JwtAuthenticationFilter jwtAuthenticationFilter;
    
    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
    
    @Bean
    public AuthenticationManager authenticationManager(
            AuthenticationConfiguration authConfig) throws Exception {
        return authConfig.getAuthenticationManager();
    }
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .cors(cors -> cors.configurationSource(corsConfigurationSource()))
            .csrf(csrf -> csrf.disable())
            .exceptionHandling(exception -> exception
                .authenticationEntryPoint(jwtAuthenticationEntryPoint)
            )
            .sessionManagement(session -> session
                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)
            )
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/api/v1/auth/**").permitAll()
                .requestMatchers("/api/v1/products/**").permitAll()
                .requestMatchers("/health", "/actuator/**").permitAll()
                .requestMatchers("/swagger-ui/**", "/v3/api-docs/**").permitAll()
                .requestMatchers("/api/v1/admin/**").hasRole("ADMIN")
                .anyRequest().authenticated()
            );
        
        http.addFilterBefore(jwtAuthenticationFilter, 
                           UsernamePasswordAuthenticationFilter.class);
        
        return http.build();
    }
    
    @Bean
    public CorsConfigurationSource corsConfigurationSource() {
        CorsConfiguration configuration = new CorsConfiguration();
        configuration.setAllowedOrigins(Arrays.asList(
            "http://localhost:3000",
            "https://yourdomain.com"
        ));
        configuration.setAllowedMethods(Arrays.asList("GET", "POST", "PUT", "DELETE", "OPTIONS"));
        configuration.setAllowedHeaders(Arrays.asList("*"));
        configuration.setAllowCredentials(true);
        configuration.setMaxAge(3600L);
        
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/**", configuration);
        
        return source;
    }
}</code></pre>
                    </div>
                </div>
            </section>

            <section class="content-section">
                <h2><i class="fas fa-cubes"></i> ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜</h2>

                <div class="microservices">
                    <h3>ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì„¤ê³„ íŒ¨í„´</h3>
                    
                    <div class="api-gateway">
                        <h4>API Gateway (Node.js)</h4>
                        <pre><code>// gateway/index.js
import express from 'express';
import httpProxy from 'http-proxy-middleware';
import rateLimit from 'express-rate-limit';
import CircuitBreaker from 'opossum';
import { authenticateRequest } from './middleware/auth';
import { logger } from './utils/logger';

const app = express();

// ì„œë¹„ìŠ¤ ì •ì˜
const services = {
    auth: {
        url: process.env.AUTH_SERVICE_URL || 'http://auth-service:3001',
        breaker: new CircuitBreaker(httpProxy.createProxyMiddleware, {
            timeout: 3000,
            errorThresholdPercentage: 50,
            resetTimeout: 30000
        })
    },
    user: {
        url: process.env.USER_SERVICE_URL || 'http://user-service:3002',
        breaker: new CircuitBreaker(httpProxy.createProxyMiddleware, {
            timeout: 3000,
            errorThresholdPercentage: 50,
            resetTimeout: 30000
        })
    },
    product: {
        url: process.env.PRODUCT_SERVICE_URL || 'http://product-service:3003',
        breaker: new CircuitBreaker(httpProxy.createProxyMiddleware, {
            timeout: 3000,
            errorThresholdPercentage: 50,
            resetTimeout: 30000
        })
    },
    order: {
        url: process.env.ORDER_SERVICE_URL || 'http://order-service:3004',
        breaker: new CircuitBreaker(httpProxy.createProxyMiddleware, {
            timeout: 3000,
            errorThresholdPercentage: 50,
            resetTimeout: 30000
        })
    }
};

// Rate limiting
const limiter = rateLimit({
    windowMs: 15 * 60 * 1000,
    max: 100,
    standardHeaders: true,
    legacyHeaders: false,
});

app.use(limiter);

// í—¬ìŠ¤ ì²´í¬
app.get('/health', (req, res) => {
    const healthStatus = {
        gateway: 'healthy',
        services: {}
    };
    
    Object.keys(services).forEach(service => {
        healthStatus.services[service] = {
            state: services[service].breaker.stats.state,
            failures: services[service].breaker.stats.failures,
            successes: services[service].breaker.stats.successes
        };
    });
    
    res.json(healthStatus);
});

// ì„œë¹„ìŠ¤ ë¼ìš°íŒ…
Object.keys(services).forEach(serviceName => {
    const service = services[serviceName];
    const path = `/api/${serviceName}`;
    
    app.use(path, async (req, res, next) => {
        try {
            // ì¸ì¦ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ í™•ì¸
            if (serviceName !== 'auth' && !req.path.includes('/public')) {
                await authenticateRequest(req, res, next);
            }
            
            // Circuit Breakerë¥¼ í†µí•œ í”„ë¡ì‹œ
            const proxy = await service.breaker.fire({
                target: service.url,
                changeOrigin: true,
                pathRewrite: {
                    [`^/api/${serviceName}`]: ''
                },
                onProxyReq: (proxyReq, req) => {
                    // ì‚¬ìš©ì ì •ë³´ ì „ë‹¬
                    if (req.user) {
                        proxyReq.setHeader('X-User-Id', req.user.id);
                        proxyReq.setHeader('X-User-Role', req.user.role);
                    }
                },
                onError: (err, req, res) => {
                    logger.error(`Proxy error for ${serviceName}:`, err);
                    res.status(503).json({
                        error: 'Service temporarily unavailable',
                        service: serviceName
                    });
                }
            });
            
            proxy(req, res, next);
        } catch (error) {
            logger.error(`Circuit breaker open for ${serviceName}`);
            res.status(503).json({
                error: 'Service unavailable due to circuit breaker',
                service: serviceName
            });
        }
    });
});

// ì—ëŸ¬ í•¸ë“¤ë§
app.use((error, req, res, next) => {
    logger.error('Gateway error:', error);
    res.status(500).json({
        error: 'Internal gateway error',
        message: process.env.NODE_ENV === 'development' ? error.message : undefined
    });
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
    logger.info(`API Gateway running on port ${PORT}`);
});</code></pre>
                    </div>

                    <div class="message-queue">
                        <h4>ë©”ì‹œì§€ í í†µí•© (RabbitMQ)</h4>
                        <pre><code>// services/messageQueue.js
import amqp from 'amqplib';
import { logger } from '../utils/logger';

class MessageQueue {
    constructor() {
        this.connection = null;
        this.channel = null;
        this.queues = {};
    }

    async connect() {
        try {
            this.connection = await amqp.connect(process.env.RABBITMQ_URL);
            this.channel = await this.connection.createChannel();
            
            // ì—°ê²° ì—ëŸ¬ ì²˜ë¦¬
            this.connection.on('error', (err) => {
                logger.error('RabbitMQ connection error:', err);
                setTimeout(() => this.connect(), 5000);
            });
            
            this.connection.on('close', () => {
                logger.info('RabbitMQ connection closed, reconnecting...');
                setTimeout(() => this.connect(), 5000);
            });
            
            logger.info('Connected to RabbitMQ');
            
            // ê¸°ë³¸ í ì„¤ì •
            await this.setupQueues();
        } catch (error) {
            logger.error('Failed to connect to RabbitMQ:', error);
            setTimeout(() => this.connect(), 5000);
        }
    }

    async setupQueues() {
        // ì£¼ë¬¸ ì´ë²¤íŠ¸ í
        await this.createQueue('order.created', { durable: true });
        await this.createQueue('order.updated', { durable: true });
        await this.createQueue('order.cancelled', { durable: true });
        
        // ì¬ê³  ì´ë²¤íŠ¸ í
        await this.createQueue('inventory.updated', { durable: true });
        await this.createQueue('inventory.low', { durable: true });
        
        // ì•Œë¦¼ í
        await this.createQueue('notification.email', { durable: true });
        await this.createQueue('notification.sms', { durable: true });
        
        // Dead Letter Queue
        await this.createQueue('dlq', { 
            durable: true,
            arguments: {
                'x-message-ttl': 86400000 // 24ì‹œê°„
            }
        });
    }

    async createQueue(queueName, options = {}) {
        await this.channel.assertQueue(queueName, options);
        this.queues[queueName] = true;
    }

    async publish(queue, message, options = {}) {
        if (!this.queues[queue]) {
            await this.createQueue(queue);
        }
        
        const messageBuffer = Buffer.from(JSON.stringify(message));
        
        return this.channel.sendToQueue(queue, messageBuffer, {
            persistent: true,
            timestamp: Date.now(),
            ...options
        });
    }

    async subscribe(queue, handler, options = {}) {
        if (!this.queues[queue]) {
            await this.createQueue(queue);
        }
        
        await this.channel.prefetch(options.prefetch || 1);
        
        return this.channel.consume(queue, async (msg) => {
            if (!msg) return;
            
            try {
                const content = JSON.parse(msg.content.toString());
                await handler(content, msg);
                
                // ë©”ì‹œì§€ í™•ì¸
                this.channel.ack(msg);
            } catch (error) {
                logger.error(`Error processing message from ${queue}:`, error);
                
                // ì¬ì‹œë„ ë¡œì§
                const retryCount = (msg.properties.headers['x-retry-count'] || 0) + 1;
                
                if (retryCount <= 3) {
                    // ì¬ì‹œë„
                    await this.publish(queue, JSON.parse(msg.content.toString()), {
                        headers: {
                            'x-retry-count': retryCount,
                            'x-original-error': error.message
                        }
                    });
                } else {
                    // Dead Letter Queueë¡œ ì´ë™
                    await this.publish('dlq', {
                        originalQueue: queue,
                        message: JSON.parse(msg.content.toString()),
                        error: error.message,
                        timestamp: new Date()
                    });
                }
                
                // ë©”ì‹œì§€ ê±°ë¶€ (ì¬íì‰í•˜ì§€ ì•ŠìŒ)
                this.channel.nack(msg, false, false);
            }
        });
    }

    async publishEvent(eventType, data) {
        const event = {
            type: eventType,
            data,
            timestamp: new Date(),
            correlationId: data.correlationId || this.generateCorrelationId()
        };
        
        await this.publish(`${eventType}`, event);
        logger.info(`Event published: ${eventType}`);
    }

    generateCorrelationId() {
        return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
    }
}

export default new MessageQueue();</code></pre>
                    </div>
                </div>
            </section>

            <section class="practice">
                <h2><i class="fas fa-laptop-code"></i> ì‹¤ìŠµ: í’€ìŠ¤íƒ ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¶•</h2>

                <div class="practice-content">
                    <h3>ì‹¤ì‹œê°„ ì±„íŒ… ì• í”Œë¦¬ì¼€ì´ì…˜ ë§Œë“¤ê¸°</h3>
                    <p>AIì™€ í•¨ê»˜ WebSocketì„ í™œìš©í•œ ì‹¤ì‹œê°„ ì±„íŒ… ì„œë²„ë¥¼ êµ¬ì¶•í•´ë´…ì‹œë‹¤.</p>

                    <div class="chat-requirements">
                        <h4>ìš”êµ¬ì‚¬í•­</h4>
                        <ul>
                            <li>ì‹¤ì‹œê°„ ë©”ì‹œì§€ ì „ì†¡/ìˆ˜ì‹ </li>
                            <li>ì±„íŒ…ë°© ìƒì„± ë° ê´€ë¦¬</li>
                            <li>ì‚¬ìš©ì ì¸ì¦ ë° ê¶Œí•œ</li>
                            <li>ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬ ì €ì¥</li>
                            <li>íŒŒì¼/ì´ë¯¸ì§€ ê³µìœ </li>
                            <li>ì˜¨ë¼ì¸ ìƒíƒœ í‘œì‹œ</li>
                        </ul>
                    </div>

                    <div class="implementation-guide">
                        <h4>êµ¬í˜„ ê°€ì´ë“œ</h4>
                        
                        <div class="step">
                            <h5>1. ë°±ì—”ë“œ ì„ íƒ</h5>
                            <p>ì„ í˜¸í•˜ëŠ” ë°±ì—”ë“œ í”„ë ˆì„ì›Œí¬ ì„ íƒ (Node.js, Python, Java)</p>
                        </div>
                        
                        <div class="step">
                            <h5>2. WebSocket ì„œë²„</h5>
                            <p>Chatì— ìš”ì²­: "Socket.IOë¥¼ ì‚¬ìš©í•œ ì‹¤ì‹œê°„ ì±„íŒ… ì„œë²„ êµ¬ì¡°ë¥¼ ë§Œë“¤ì–´ì¤˜"</p>
                        </div>
                        
                        <div class="step">
                            <h5>3. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„</h5>
                            <p>Cmd+K: "ì±„íŒ… ë©”ì‹œì§€ì™€ ì±„íŒ…ë°©ì„ ìœ„í•œ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì„¤ê³„í•´ì¤˜"</p>
                        </div>
                        
                        <div class="step">
                            <h5>4. ì¸ì¦ ì‹œìŠ¤í…œ</h5>
                            <p>Composerë¡œ JWT ê¸°ë°˜ ì¸ì¦ êµ¬í˜„</p>
                        </div>
                        
                        <div class="step">
                            <h5>5. ë©”ì‹œì§€ í í†µí•©</h5>
                            <p>AIì—ê²Œ: "ëŒ€ê·œëª¨ ë©”ì‹œì§€ ì²˜ë¦¬ë¥¼ ìœ„í•œ í ì‹œìŠ¤í…œ ì¶”ê°€í•´ì¤˜"</p>
                        </div>
                    </div>

                    <div class="architecture-tips">
                        <h4>ğŸ—ï¸ ì•„í‚¤í…ì²˜ íŒ</h4>
                        <ul>
                            <li>Redisë¡œ ì„¸ì…˜ ê´€ë¦¬ ë° ìºì‹±</li>
                            <li>MongoDBë‚˜ Cassandraë¡œ ë©”ì‹œì§€ ì €ì¥</li>
                            <li>Nginxë¡œ WebSocket ë¡œë“œë°¸ëŸ°ì‹±</li>
                            <li>Docker Composeë¡œ ê°œë°œ í™˜ê²½ êµ¬ì„±</li>
                            <li>Kubernetesë¡œ í”„ë¡œë•ì…˜ ë°°í¬</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section class="summary">
                <h2><i class="fas fa-check-circle"></i> í•µì‹¬ ì •ë¦¬</h2>
                
                <div class="key-points">
                    <div class="point">
                        <i class="fas fa-star"></i>
                        <h3>í”„ë ˆì„ì›Œí¬ë³„ ìµœì í™”</h3>
                        <p>ê° ë°±ì—”ë“œ í”„ë ˆì„ì›Œí¬ì˜ íŠ¹ì„±ì„ ì´í•´í•˜ê³  ìµœì ì˜ ì½”ë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
                    </div>
                    
                    <div class="point">
                        <i class="fas fa-star"></i>
                        <h3>ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì„¤ê³„</h3>
                        <p>ë¶„ì‚° ì‹œìŠ¤í…œì˜ ë³µì¡ì„±ì„ AIê°€ ê´€ë¦¬í•˜ë©° íš¨ìœ¨ì ì¸ ì•„í‚¤í…ì²˜ë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.</p>
                    </div>
                    
                    <div class="point">
                        <i class="fas fa-star"></i>
                        <h3>ì‹¤ì‹œê°„ í†µì‹  êµ¬í˜„</h3>
                        <p>WebSocket, ë©”ì‹œì§€ í ë“± ì‹¤ì‹œê°„ ê¸°ëŠ¥ì„ ì‰½ê²Œ êµ¬í˜„í•©ë‹ˆë‹¤.</p>
                    </div>
                    
                    <div class="point">
                        <i class="fas fa-star"></i>
                        <h3>ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ë³´ì•ˆ</h3>
                        <p>ì¸ì¦, ì¸ê°€, ì•”í˜¸í™” ë“± ë³´ì•ˆ ìš”êµ¬ì‚¬í•­ì„ ìë™ìœ¼ë¡œ ì ìš©í•©ë‹ˆë‹¤.</p>
                    </div>
                </div>

                <div class="next-steps">
                    <h3>ë‹¤ìŒ ê°•ì˜ ì˜ˆê³ </h3>
                    <p>ë‹¤ìŒ ê°•ì˜ì—ì„œëŠ” Dockerì™€ Kubernetesë¥¼ í™œìš©í•œ ì»¨í…Œì´ë„ˆí™”ì™€ ë°°í¬ë¥¼ ë°°ì›ë‹ˆë‹¤.</p>
                    <a href="lesson18.html" class="btn btn-primary">
                        <i class="fas fa-arrow-right"></i> ë‹¤ìŒ ê°•ì˜ë¡œ ì´ë™
                    </a>
                </div>
            </section>
        </main>

        <aside class="sidebar">
            <div class="sidebar-section">
                <h3><i class="fas fa-list"></i> ê°•ì˜ ëª©ì°¨</h3>
                <ol class="lesson-list">
                    <li class="completed">Cursor ì†Œê°œì™€ ì„¤ì¹˜</li>
                    <li class="completed">ì²« ë²ˆì§¸ AI ìë™ì™„ì„±</li>
                    <li class="completed">AI Chat ë§ˆìŠ¤í„°í•˜ê¸°</li>
                    <li class="completed">Cmd+K ì™„ë²½ ê°€ì´ë“œ</li>
                    <li class="completed">í”„ë¡œì íŠ¸ ì»¨í…ìŠ¤íŠ¸</li>
                    <li class="completed">AI ëª¨ë¸ ì„ íƒê³¼ í™œìš©</li>
                    <li class="completed">Composer ê¸°ëŠ¥ í™œìš©</li>
                    <li class="completed">í„°ë¯¸ë„ í†µí•©</li>
                    <li class="completed">ë””ë²„ê¹…ê³¼ ì—ëŸ¬ í•´ê²°</li>
                    <li class="completed">ë‹¨ì¶•í‚¤ì™€ ì„¤ì • ìµœì í™”</li>
                    <li class="completed">Git í†µí•©ê³¼ ë²„ì „ ê´€ë¦¬</li>
                    <li class="completed">í…ŒìŠ¤íŠ¸ ì‘ì„±ê³¼ TDD</li>
                    <li class="completed">ë¦¬íŒ©í† ë§ê³¼ ì½”ë“œ í’ˆì§ˆ</li>
                    <li class="completed">API ê°œë°œê³¼ ë¬¸ì„œí™”</li>
                    <li class="completed">ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ì™€ ìµœì í™”</li>
                    <li class="completed">í”„ë¡ íŠ¸ì—”ë“œ í”„ë ˆì„ì›Œí¬ì™€ Cursor AI</li>
                    <li class="current">ë°±ì—”ë“œ í”„ë ˆì„ì›Œí¬ì™€ Cursor AI</li>
                </ol>
            </div>

            <div class="sidebar-section">
                <h3><i class="fas fa-server"></i> ë°±ì—”ë“œ ê¸°ìˆ  ìŠ¤íƒ</h3>
                <div class="tech-stack">
                    <div class="stack-category">
                        <h4>Node.js</h4>
                        <span class="tech-badge">Express</span>
                        <span class="tech-badge">NestJS</span>
                        <span class="tech-badge">Fastify</span>
                    </div>
                    <div class="stack-category">
                        <h4>Python</h4>
                        <span class="tech-badge">FastAPI</span>
                        <span class="tech-badge">Django</span>
                        <span class="tech-badge">Flask</span>
                    </div>
                    <div class="stack-category">
                        <h4>Java</h4>
                        <span class="tech-badge">Spring Boot</span>
                        <span class="tech-badge">Micronaut</span>
                        <span class="tech-badge">Quarkus</span>
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <h3><i class="fas fa-lightbulb"></i> í”„ë¡œ íŒ</h3>
                <div class="tip-box">
                    <p>ğŸ’¡ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¥¼ ì‹œì‘í•  ë•ŒëŠ” ëª¨ë†€ë¦¬ìŠ¤ë¡œ ì‹œì‘í•˜ì—¬ ì ì§„ì ìœ¼ë¡œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. Cursor AIê°€ ë¦¬íŒ©í† ë§ ê³¼ì •ì„ ë„ì™€ì¤„ ê²ƒì…ë‹ˆë‹¤.</p>
                </div>
            </div>
        </aside>

        <div class="progress-tracker">
            <div class="progress-bar" style="width: 56.67%"></div>
            <span class="progress-text">17/30 ì™„ë£Œ</span>
        </div>
    </div>

    <script src="../assets/lesson-script.js"></script>
</body>
</html>